scraper:
  schedule:
    crontab: 0 12 * * *
  pipeline:
    - run: add_metadata
      parameters:
        name: government_decisions
        title: Government Decisions Scraper
        homepage: https://www.gov.il/he/Departments/policies
    - run: scraper
      runner: tzabar
      parameters:
        resource:
          name: gov_decisions
          path: data/government_decisions.csv
    - run: set_types
      parameters:
        types:
          title:
            es:title: true
    - run: set_types
      parameters:
        types:
          doc_published_date:
            format: default
          doc_update_date:
            format: default
          publish_date:
            format: default
          publish_date_prod:
            format: default
          update_date:
            format: default
    - run: set_primary_key
      parameters:
        gov_decisions:
          - id
    - run: dump_to_path
      parameters:
        out-path: /var/datapackages/government_decisions/scraper/
    - run: dump_to_sql
      parameters:
        tables:
          government_decisions:
            resource-name: gov_decisions
            mode: update

government_decisions:            
  dependencies:
    - pipeline: ./government_decisions/scraper
  pipeline:
    - run: add_metadata
      parameters:
        name: government_decisions
        title: Government Decisions
        homepage: https://www.gov.il/he/Departments/policies
    - run: add_sql_resource
      parameters:
        datapackage: /var/datapackages/government_decisions/scraper/datapackage.json
        resource: gov_decisions
        table: government_decisions
    - run: stream_remote_resources
    - run: allstar_dumper
      parameters:
        out-path: /var/datapackages/government_decisions
