all:
  dependencies:
    - pipeline: ./activities/social_services/historic_data
  pipeline:
    - run: load
      parameters:
        from: /var/datapackages/activities/social_services/historic_data/datapackage.json
    - run: concatenate
      parameters:
        target:
          name: activities
          path: activities.csv
        fields:
          kind: []
          kind_he: []
          activity_name: []
          activity_description: []
          publisher_name: []
          history: []
          max_year: []
          min_year: []
    - run: set_primary_key
      parameters:
        activities:
          - kind
          - publisher_name
          - activity_name
    - run: set_types
      parameters:
        types:
          activity_name:
            es:title: true
          activity_description:
            es:itemType: string
            es:boost: true
          kind:
            es:keyword: true
            es:exclude: true
          kind_he:
            es:keyword: true
            es:exclude: true
          publisher_name:
            es:keyword: true
          history:
            es:itemType: object
            es:schema:
              fields:
                - {name: year, type: integer}
                - {name: unit, type: string}
                - {name: subunit, type: string}
                - {name: subsubunit, type: string}
                - {name: allocated_budget, type: integer}
                - {name: num_beneficiaries, type: string, es:index: false}
    - run: dump_to_path
      parameters:
        out-path: /var/datapackages/activities/all
    - run: dump_to_sql
      parameters:
        tables:
          activities:
            resource-name: activities
